1. [Hyperledger Iroha](index.html)
2. [Hyperledger Iroha](Hyperledger-Iroha_20873224.html)
3. [Iroha 2](Iroha-2_21012047.html)
4. [Architecture Decision Records Log](Architecture-Decision-Records-Log_21016003.html)
5. [Multisignature transactions](Multisignature-transactions_21012372.html)

# Hyperledger Iroha : Pending and MST transactions sharing between peers

Created by Nikita Puzankov, last modified on Jul 03, 2020

## Shorthand

Discussion participants: [Egor Ivkov](https://lf-hyperledger.atlassian.net/wiki/people/5dd9631c1cf3c20ef5ff9f0f?ref=confluence), [Kamil Salakhiev](https://lf-hyperledger.atlassian.net/wiki/people/557058:07723e0b-a027-4cc4-ad6d-324e41cccb4d?ref=confluence), [Andrei Lebedev](https://lf-hyperledger.atlassian.net/wiki/people/557058:c02f1b3d-42e6-4519-ba84-2d0476dccbc9?ref=confluence), [Nikita Puzankov](https://lf-hyperledger.atlassian.net/wiki/people/5df113768998970e5b434e0a?ref=confluence)

[Egor Ivkov](https://lf-hyperledger.atlassian.net/wiki/people/5dd9631c1cf3c20ef5ff9f0f?ref=confluence) :

> @mtakemiya what should be the actions of a peer when it receives pending transactions as part of gossip between peers?

[Kamil Salakhiev](https://lf-hyperledger.atlassian.net/wiki/people/557058:07723e0b-a027-4cc4-ad6d-324e41cccb4d?ref=confluence) :

> if transaction has less signatures than the size of the quorum, then we should put it into the pending transaction pool. In the pool we maintain the signatures of transactions, so that when some transaction collected enough signatures it is sent further into the pipeline (in case of Iroha 1 transaction was sent to ordering service)

[Andrei Lebedev](https://lf-hyperledger.atlassian.net/wiki/people/557058:c02f1b3d-42e6-4519-ba84-2d0476dccbc9?ref=confluence) :

> However, size of the quorum is unknown when the transaction is received

[Kamil Salakhiev](https://lf-hyperledger.atlassian.net/wiki/people/557058:07723e0b-a027-4cc4-ad6d-324e41cccb4d?ref=confluence) :

> yes, in Iroha1 quorum was put into transaction, but there were no way to check that given quorum is valid, right?

[Andrei Lebedev](https://lf-hyperledger.atlassian.net/wiki/people/557058:c02f1b3d-42e6-4519-ba84-2d0476dccbc9?ref=confluence) :

> Considering this approach, it may be better to try to process it until it becomes valid or expires. It is possible to check quorum if WSV is accessed.

[Kamil Salakhiev](https://lf-hyperledger.atlassian.net/wiki/people/557058:07723e0b-a027-4cc4-ad6d-324e41cccb4d?ref=confluence) :

> yes, so for MST transactions we kind of start stateful validation earlier? although if WSV is in memory then there is no issue, so we don’t need to put quorum into transaction as it was in Iroha1.

[武宮誠](https://lf-hyperledger.atlassian.net/wiki/people/557058:12c320e6-5d17-404f-b20e-bfa5721ae960?ref=confluence) :

> It should validate the stateless data (format, signatures) and add it to their queue. One of these lucky peers will become the block creator and leader of consensus for the next block.
> 
> It is probably okay to wait for multisig quorum check until later. The block creator can do that. Otherwise another approach is to create a pending multisig tx queue and put it in there. Either approach seems acceptable I think.

## TL;DR

For [Multisignature transactions](Multisignature-transactions_21012372.html) we have the following algorithm: keep them in "pending" transaction queue until we will receive enough equal transactions with different valid signatures. Then we process them as usual single signature transaction.

## Current State

Right now in our implementation Transaction has four states: Requested, Accepted, Signed and Valid.  
In code we have:  
1\. When torii receives transaction from client its state is \`Requested\`.  
2\. Then the transaction is added to the queue of \`pending\_tx\` and its state becomes \`Accepted\`

**In what state should transactions be forwarded to other peers?**

Nikita Puzankov suggested: Periodically all the transactions from the queue are forwarded to other peers, and when forwarding their state turns again to \`Requested\`. And they are added to the queue by receiving peers making state again \`Accepted\`.

Egor Ivkov suggested: Peer should sign it's transactions before forwarding them, otherwise we will not be able to gather signatures and proceed to Signed state.

**When are the transactions signed?**

**Based on current implementation there can be a situation when peer receives pending\_tx that it already built a block from, so it will build another block from the same tx. How should this situation be handled?**

Document generated by Confluence on Nov 26, 2024 15:06

[Atlassian](http://www.atlassian.com/)
